<!DOCTYPE html>
<html>
<head>
  <title>OpenAI Text Analyzer</title>
  <style>
    body { width: 300px; padding: 10px; }
    input { width: 100%; margin: 5px 0; }
  </style>
</head>
<body>
  <h3>OpenAI Text Analyzer</h3>
  <input type="password" id="apiKey" placeholder="Enter your OpenAI API key">
  <button id="save">Save API Key</button>
  <script src="popup.js"></script>
</body>
</html>

// popup.js
document.getElementById('save').addEventListener('click', () => {
  const apiKey = document.getElementById('apiKey').value;
  chrome.storage.sync.set({ apiKey }, () => {
    alert('API key saved!');
  });
});

// background.js
chrome.runtime.onInstalled.addListener(() => {
  chrome.contextMenus.create({
    id: "analyzeText",
    title: "Analyze with OpenAI",
    contexts: ["selection"]
  });
});

chrome.contextMenus.onClicked.addListener(async (info, tab) => {
  if (info.menuItemId === "analyzeText") {
    const { apiKey } = await chrome.storage.sync.get('apiKey');
    if (!apiKey) {
      alert('Please set your OpenAI API key first!');
      return;
    }

    try {
      const response = await fetch('https://api.openai.com/v1/chat/completions', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': `Bearer ${apiKey}`
        },
        body: JSON.stringify({
          model: "gpt-3.5-turbo",
          messages: [{
            role: "user",
            content: info.selectionText
          }],
          max_tokens: 150
        })
      });

      const data = await response.json();
      const answer = data.choices[0].message.content;
      
      // Show answer in an alert (you could modify this to show in a more elegant way)
      alert(answer);
    } catch (error) {
      alert('Error: ' + error.message);
    }
  }
});